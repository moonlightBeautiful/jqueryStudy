<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>跨域解决方案-jsonP</title>
    <script type="text/javascript" src="../js/jquery-1.4.1.js"></script>


</head>
<body>
<p>
    为了便于客户端使用数据，逐渐形成了一种非正式传输协议（传递数据的一种方式），人们把它称作JSONP。<br>
    JSONP即JSON with Padding。由于同源策略的限制，XmlHttpRequest只允许请求当前源（域名、协议、端口）的资源。<br>
    如果要进行跨域请求，我们可以通过使用 html的script标记来进行跨域请求，并在响应中返回要执行的script代码，其中可以直接使用JSON传递javascript对象。这种跨域 的通讯方式称为JSONP。<br>
    该协议的要点是客户端传递一个callback参数给服务端，然后服务端返回数据时将这个callback参数作为函数名来包裹住JSON数据，<br>
    这样客户端就可以随意定制自己的函数来自动处理返回数据了。<br>
    Ajax直接请求普通文件存在跨域无权限访问的问题<br>
    Web页面上调用js（非本地的）文件时不受是否跨域的影响（而且凡是拥有”src”这个属性的标签都拥有跨域的能力，比如<\script>、<\img>、<\iframe>）。
</p>
<p>Jsonp(JSON with Padding) 是 json 的一种"使用模式"，可以让网页从别的域名（网站）那获取资料，即跨域读取数据。</p>
<!--<input id="userNumber" value="1">
<input id="userName" value="张三">-->


<!-- 先单点登录一下，在请求服务器页面-->

<!-- 第一种 直接在script的src中写跨域地址，在回调函数中处理收到的数据 -->
<!--<script>
    function say() {
        alert("方式1");
    }
</script>
<script type="text/javascript"
        src="http://10.0.102.142:8080/avidm/plm/mpm/test/test.jsp?callback=say"></script>-->

<!-- <script type="text/javascript">
     /*var localHandler = function(data){
         alert('我是本地函数，可以被跨域的remote.js文件调用，远程js带来的数据是：' + data.result);
     };*/
     function localHandler(data){
         alert('我是客户端js函数，可以被跨域的js文件调用，跨域的js带来的数据是：' + data.result);
     }
 </script>
 <script type="text/javascript" src="./remote.js"></script>-->

<!-- 第二种  提交form表单，用于跳转。这种方式用户相互调用jsp界面吧-->
<!--<form id="testForm" action="http://10.0.102.142:8080/avidm/plm/mpm/test/test.jsp?callback=say" method="post">
    <input type="text" readonly="readonly" name="data" value="[data1:{name:zhangsan,age:13},data2:{name:李四,age:14}]">
    <input type="button" value="提交表单" onclick="submitForm()">
</form>
<script>
    function submitForm() {
        $("#testForm").submit();
    }
</script>-->

<!--第三种，jquery的jsonp方式  -->
<script>
    /**
     * getJSON：通过 HTTP GET 请求载入 JSON 数据，
     * 在jQuery 1.2 以后的版本，您可以通过使用 JSONP 形式的回调函数来加载其他网域的 JSON 数据
     *
     *  */
    $(document).ready(function () {
        /**
         * 跨域1，$.ajax({})，遇到问题：success不执行
         *      dataType: 'jsonp'时，和getJson一样，success函数只有一个入参
         * */
        $.ajax({
            url: 'http://10.0.102.142:8080/avidm/plm/mpm/test/test.jsp',
            type: 'get', //默认就是get
            dataType: 'jsonp',  //jsonP才可以跨域，json不可以跨域
            //callback:'callback',  //可以不写，默认传入参数名callback
            //jsonpCallback:'success_jsonpCallback',  //可以不写，默认jsonp+随机生成的数字，反正最后执行的是success方法，会把数据传到success方法中执行
            data: {
                userName: 'zhangSan'
            },
            success: function (responseObj) {
                alert(responseObj.name1);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(textStatus);
            }
        });

        /* *
         * 跨域2，$.getJSON，
         *      三个参数，url，传参data，回调函数（一个参数json对象）
         * 遇到问题：无法调通，必须需要在请求后面添加个键值对，如果值是？，则随机生成值，
         *      一般key使用callback，也可以是其他的。
         *      一般value使用？，也可以指定
         **/
        /* var url = "http://10.0.102.142:8080/avidm/plm/mpm/test/test.jsp?callback=?";
         var data = {"userName": "zhangSan"};
         $.getJSON(url, data, function (responseObj) {
             alert(responseObj.name1);
         });*/
    });
</script>
</body>
</html>